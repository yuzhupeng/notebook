# 溯源篇

[恶意样本分析手册–溯源篇](http://blog.nsfocus.net/trace-source/)

感觉溯源更像是一种社工,去获取很多信息

溯源分析旨在通过现象去发掘样本背后的故事，没有固定的套路可循，

在分析过程中，要像侦探破案一样，大胆心细，不放过任何细枝末节，是一场人与人之间斗智斗勇的过程。

“天网恢恢疏而不漏“，

此外，在对样本进行行为分析的时候，最好能够断网分析或是使用一个干净的网络。

首先是为什么要断网分析，我们在分析的时候，如果目标的服务器还是存活的，那么样本运行之后，就会和目标服务器建立通信，然后进行交互。

样本大多会有收集当前主机信息并上传到服务器的功能，

如果虚拟机的配置被打包上传到攻击者服务器，一方面，攻击者将会知道你的出口IP地址。

另一方面，攻击者将知道自己的样本已经暴露，已经有分析人员在分析，从而导致攻击者关闭服务器或是采取其他行为。

还有一个重要的因素是，如果是在公司的网路环境进行分析的，公司一般都会有流量监控，如果检测到连接了已经确认是恶意的C2服务器，

就会触发警报，一方面公司可能请你喝茶，

另一方面如果样本具备其他的功能，可能会出现公司网络未授权访问xxx的情况。

所以综上所述，断网分析恶意样本是一个好习惯。

但是有时候，样本会检测网络是否正常，如果不正常就直接退出了，遇到这种情况，可以

1 修改样本判定网络的条件，使得可以正常运行
2 搭建安全的网络进行分析

fakenet：[https://github.com/fireeye/flare-fakenet-ng](https://github.com/fireeye/flare-fakenet-ng)

在联网的虚拟机中安装该工具后，将会构建一个虚拟网络，此时，通过主机产生的所有网络请求、流量将不会发送出去，而是发送到fakenet中。

此外，fakenet还会根据请求的内容进行对应的响

不过有一点可以确认单纯掌握样本分析技能是远远不够的。

下面列举了几个方向，感兴趣的读者可以去进行深入学习：

A）渗透测试

B）应急响应

C）取证分析

D）数据分析

E）漏洞分析

掌握上述技能后，以守为攻，变换角色，从多个维度去进行样本分析攻击溯源，进而输出高质量的样本分析报告。
