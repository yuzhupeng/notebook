# 01:静态分析技术

# 反病毒引擎扫描:

其实就是一个用于检测有没有病毒的东西

如何检测呢?

1), 字节特征码

2), 行为和模式(启发式检测)

在进行病毒检测的时候,我们通常会多个引擎一起检测

网上也有一些网站可以对你上传的文件进行一个病毒的检测

**腾讯哈勃分析系统:** [habo.qq.com/](https://link.zhihu.com/?target=https%3A//habo.qq.com/)

**VirusTotal:** [https://virustotal.com/](https://virustotal.com/)

# 恶意代码程序的哈希值

一个病毒或者说一个文件,都会有一个MD5值,这个值就相对于一个身份证

通过身份证,我们就可以识别它是不是恶意代码

可以用的工具有

md5deep [https://github.com/jessek/hashdeep/releases/tag/v4.4](https://github.com/jessek/hashdeep/releases/tag/v4.4)

WinMD5 [https://www.winmd5.com/](https://www.winmd5.com/)

md5deep

```
C:\Users\virus\Desktop\病毒软件\md5deep-4.4\md5deep-4.4>md5deep.exe C:\Users\virus\Desktop\测试程序\services.exe
md5deep.exe: WARNING: You are running a 32-bit program on a 64-bit system.
md5deep.exe: You probably want to use the 64-bit version of this program.
68fb9b0e5ea76508103e4b97e72e39e1  C:\Users\virus\Desktop\娴嬭瘯绋嬪簭\services.exe

C:\Users\virus\Desktop\病毒软件\md5deep-4.4\md5deep-4.4>
```

WinMD5

![Untitled](01%20%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%204084bf9ce7df425f87ab62d4a72e270c/Untitled.png)

# 查找字符串

打印的信息,链接的URL,或者是复制文件到某个特定的位置

字符串有2种形式, ASCII和Unicode

所以按照不同的方式去搜索一个可执行程序出现的字符串,

然后猜测该程序可能的操作和行为来检测是不是病毒

可以进行字符串提取的工具很多,书中提到了strings程序

strings.exe [https://download.sysinternals.com/files/Strings.zip](https://download.sysinternals.com/files/Strings.zip)  [https://learn.microsoft.com/en-us/sysinternals/downloads/strings](https://learn.microsoft.com/en-us/sysinternals/downloads/strings)

简单的使用:

```
C:\Users\virus\Desktop\病毒软件\Strings>strings.exe services.exe

Strings v2.54 - Search for ANSI and Unicode strings in binary images.
Copyright (C) 1999-2021 Mark Russinovich
Sysinternals - www.sysinternals.com

ZPA30

!
b232CCSTev
$$
vdTTTdUUeeTdvf
yXETDDTVUeUdevv
```

# 加壳和混淆恶意代码

让文件更难检测或者分析

混淆是尝试去隐藏其执行过程的代码,加壳也是混淆的一种

常见的加壳比如upx

注意: 加壳和混淆代码通常至少会包含LoadLibiary和GetProcAddress

查壳的软件: PEID,DIE

其特征:

字符串的信息很少

调用的API也很好, 标志性API就是LoadLibiary和GetProcAddress

PE文件信息中, virtualsize 远大于 sizeofRawdata

# 链接库与函数

对于一个可执行程序,我们可以收集到最有用的信息之一就是它的导入表

## 静态链接,运行时链接,动态链接

静态链接: 把需要调用的所以API都拷贝到自己的文件里面

运行时链接: 要用才载入

动态链接: 程序加载的时候才加载所有API到自己的文件

运行时链接并不流行,但是在恶意代码中是常用的

动态链接最为流行,所以是我们该关注的

还就就是通过LoadLibiary,GetProcAddress我们可以访问任何库的任何函数

## Dependency Walker 查看动态链接函数

下载地址

官网: [https://dependencywalker.com/](https://dependencywalker.com/)

其它: [https://soft.3dmgame.com/down/204508.html](https://soft.3dmgame.com/down/204508.html)

原理就是通过PE结构查看导入表,可能它比较专业

我们知道API的导入有2种

1), 名称导入, 比较赤裸

2), 序号导入, 比较难分析

但是通过Dependency Walker 可以很好的分析导入的函数不管名称导入还是序号导入

![Untitled](01%20%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%204084bf9ce7df425f87ab62d4a72e270c/Untitled%201.png)

## 导出函数

可能会有exe去导出一些函数,那时我们需要注意一下

如果恶意代码要使用导出函数,它们经常会完全省略名字或者使用不明确或者误导性的名字

# 静态分析技术实践

## PotenKeylogger.exe

一个Github项目 键盘记录器 [https://github.com/GiacomoLaw/Keylogger/releases](https://github.com/GiacomoLaw/Keylogger/releases)

脱离程序,记录任何输入

## PackedProgram.exe

文章想要表达的意思就是

如果1个程序的字符串信息很少

或者导入的函数很少

那么它很有可能是被加壳或者混淆