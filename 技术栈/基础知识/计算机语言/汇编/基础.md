# 基础

# 调用约定

**cdecl**

cdecl调用约定又称为C调用约定，是c/c++语言缺省的调用约定。参数按照从右至左的方式入栈，函数本身不清理栈，此工作有调用者负责，返回值在eax中。

由于由调用者清理栈，所以允许可变参数函数存在。

: 也就是在call 外面完成栈平衡

**stdcall**

stdcall很多时候被称为pascal调用约定。pascal语言是早期很常见的一种教学用计算机程序设计语言，其语法严谨，参数按照从右至左的方式入栈，

函数自身清理堆栈，返回值在eax中。

: 也就是在call 内部完成栈平衡

**fastcall**

fastcall的调用方式运行相对快，因为它通过寄存器来传递参数。它使用ecx和edx传送两个双字或更小的参数，

剩下的参数按照从右至左的方式入栈，函数自身清理堆栈，返回值在eax中。

: 也就是在call 内部完成栈平衡

**naked**

naked是一个很少见的调用约定，一般不建议使用。编译器不会给这种函数增加初始化的清理代码，更特殊的是，

你不能用return返回返回值，只能用插入汇编返回结果，

此调用约定必须跟declspec同时使用，例如声明一个函数，如

```c
_declspec(naked) int add(int a,int b);
```

**pascal(废弃了)**

这是pascal语言的调用约定，跟stdcall一样，参数按照从右至左的方式入栈，函数自身清理堆栈，返回值在 eax中，vc已经废弃了这种调用方式，因此在写vc程序时，建议使用stdcall。

**thiscall**

这是c++语言特有的一种调用方式，用于类成员函数的调用约定。

如果参数确定，this指针存放于ecx寄存器，函数自身清理堆栈；

如果参数不确定，this指针在所有参数入栈后再入栈，调用者清理栈。

Thiscall不是关键字，程序员不能使用。参数按照从右至左的方式入栈。

# EFLAGS

因为它的每一位代表不同的含义， 一般情况下我们只需要了解以下标志：

| 标志 | 位 | 含义 |
| --- | --- | --- |
| CF | 0 | 进位标志。无符号数发生溢出时，该标志为1，否则为0。 |
| PF | 2 | 奇偶标志。运算结果的最低字节中包含偶数个1时，该标志为1，否则为0。 |
| AF | 4 | 辅助进位标志。运算结果的最低字节的第三位向高位进位时，该标志为1，否则为0。 |
| ZF | 6 | 0标志。运算结果未0时，该标志为1，否则为0。 |
| SF | 7 | 符号标志。运算结果未负数时，该标志为1，否则为0。 |
| DF | 10 | 方向标志。该标志为1时，字符串指令每次操作后递减ESI和EDI，为0时递增。 |
| OF | 11 | 溢出标志。有符号数发生溢出时，该标志为1，否则为0。 |

用按位与操作就可以得知某个标志是否为1。